## 第三章关系数据库理论
关系演算: 元祖关系演算, 域关系演算
```mermaid graph LR
	关系代数-->a["五个基本操作:并,差,笛卡尔积,投影,选择"]
	关系代数-->b["四个组合运算:交,等值连接,自然连接,除法"]
	关系代数-->c["关系表达式优化"]
	c-->d["基本策略:先选择,后投影,最后连接"]
	c-->e["优化算法:语法树(提前做选择操作,在做投影操作,去掉不同的属性)"]
```
###  3.1 关系数据库基本定义
- 域:具有相同类型的属性集合
- 笛卡尔积:域中元素的组合
	- 度:笛卡尔积中域的个数
	- 基:笛卡尔积的元素个数
	- 关系:笛卡尔积的子集
### 3.2 关系代数的基本术语
- 关系就是一张二维表
- 一行就是一个**元祖**或一条**记录**
- 一列就是一个**属性或一个字段**
- 域是属性的取值范围
- 关系的*码*:唯一标识表,且没有多余属性
- 外码:关系的属性是另一个关系的主码
### 3.4 关系完整性
1. 实体完整性：设置主键，且主键不能为空且不重复
2. 参照完整性：设置外键,值要么为空要么是另一个关系的主码
3. 域完整性（用户自定义完整性）：设置范围
### 3.5 传统的关系运算
- 两个关系具有相同的属性和范围,那么称两关系**相容**
- 传统的集合运算两个关系必须相容:并,交,差
### 3.6 广义笛卡尔积
- 广义笛卡尔积:第一在两个关系上,生成一个新关系,属性是两个关系属性的和,元祖是每个元祖的排列组合
### 3.7 选择运算和投影运算
- 选择运算(选择行):$\sigma_F(R)=\left\{t|t\in R \bigvee F(t)='True' \right\}$ R是关系,F是关系的属性
- 投影运算(选择列,会去除重复的元祖):$π_A(R)=\left\{t[A]|t \in R \right\}$
### 连接运算
- $\theta$连接: $\mathop{R \infty S}\limits_{A \theta B}$, 返回一个满足关系后连接起来的表(元祖相连接):
	- 从R上选择A属性组上的值与S上选择B属性组的值满足比较运算$\theta$的那些元祖如:$\mathop{R \infty S} \limits_{A < B}$ 
- 自然连接:$R \infty S$, 具有公共的属性时才能连接
	- 在两个关系的笛卡尔积中选取公共属性值相等的元祖,且非公共属性和一组公共属性上投影而形成的结果关系
	- 解释: 就是$\theta$值相等的情况, 且相等的值只保留一份
---
- 外连接:把舍弃的元祖也保存在结果关系中,其他属性填Null
- 左外连接:只把左边关系R中要舍弃的元祖保留
- 右外连接:只把右边关系S中要舍弃的元祖保留

### 除运算
- 前提:关系R(X,Y)和S(Y,Z),其中X,Y,Z为属性组,R中的Y和S中的Y可以有不同的属性名,但必须来自相同的域, 除运算$R÷S:$
- 象集:给定一个关系R(X,Z),其中X,Z为属性组,定义t[X]=x时,x在R中的象集为:
$$Z_x= \left\{t[Z]|t \in R, t[X]=x \right\}$$
- 解释:就是一个属性去一个值时,对应的另外一个属性的值

例子:设关系R(A,B,C,D)和S(C,D,F), 求R÷S
1. 计算X(非公共属性集合)的元素集合(做投影运算)
2. 计算x的象集
3. 求Y在S上的投影(取值集合)
4. 计算R÷S: 如果象集**包含**(大于等于)了Y在S上的投影,那么x就是除法的结果

---
### 例题(注意服从,先选择,后投影,最后连接)
已知给定关系如下,写出满足要求的关系代数查询表达式:
- 学生关系:S(Sno,Sname,Ssex,Sage)
- 课程关系:C(Sno,Cname,Teacher)
- 学习关系:SC(Sno,Cno,Degree)

注:Sno 学号;Sname 姓名;Ssex性别;sage年龄;Cno课程号;
1. 查询学习了c3号课程的学生的学号和成绩.
	1. $\sigma_{cno="c3"}(SC)$
	2. $π_{sno,degree}(\sigma_{cno="c3"}(SC))$
2. 查询学习了c3号课程的学生的姓名和成绩.
	1. $\sigma_{cno="c3"}(SC)$
	2. $S\infty\sigma_{cno="c3"}(SC)$
	3. $π_{sname,degree}(S)\infty\sigma_{cno="c3"}(SC))$

该方法又些缺点就是连接的时候对多出来很多不需要的属性

---
2. 后面那部分多了个塞选的部分 
	1. $\sigma_{cno="c3"}(SC)$
	2. $π_{sno,sname}(s)$
	3. $π_{sno,degree}(\sigma_{cno="c3"}(SC))$
	4. $π_{sno,sname}(S)\inftyπ_{sno,degree}(\sigma_{cno="c3"}(SC))$
3. 查询学习了maths课程的学生学号和姓名.
	1. $S \infty sc \infty c$ (做多项自然连接时注意顺序)
	2. $π_{sno,sname}(S \infty sc \infty c )$
4. 查询学习了c1号或c3号课程的学生学号和姓名
	1. $π_{sno,sname}(\sigma_{cno="c1" \bigvee sno="c3"} \infty S)$
	2. $π_{sno,sname}(S) \infty ((π_{sno}(\sigma_{cno-"c1"}(SC))))$
5. 查询学习了c1号和c3号课程的学生学号和姓名
	1. $π_{sno,sname}(S) \infty ((π_{sno}(\sigma_{cno="c1"}(sc)) \bigcap π_{sno}(\sigma_{cno="c3"}(sc))))$
	2. 解法2 $π_{sno,sname(S) \infty π_{sno}(SC \div K)}$ K是一个只有cno字段的关系,且改关系只有c1,c2两个值. 可以看见在这里除法就意味着这个关系的某一字段分别取两个不同的值,对应的象集,主要还是取决于构造的关系如何
6. 查询学习了所以课程的学生学号
	1. 注意涉及**所有**这个词的务必用除法(动态)
	2. $π_{sno,cno}(SC) \div π_{cno}(C)$

例题:
关系数据库由哪3部分组成:数据结构,操作集合和完整性

